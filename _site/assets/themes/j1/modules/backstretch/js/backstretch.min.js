/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/backstretch/js/backstretch.min.js
 # Backstretch v.2.1.16 implementation for J1 Template.
 #
 # Product/Info:
 # https://jekyll.one
 # http://srobbin.com/jquery-plugins/backstretch/
 #
 # Copyright (C) 2021 Juergen Adams
 # Copyright (C) 2017 Daniel Cohen Gindi
 # Copyright (C) 2012 Scott Robbin
 #
 # J1 Template is licensed under the MIT License.
 # See: https://github.com/jekyll-one-org/J1 Template/blob/master/LICENSE
 # Backstretch is licensed under the MIT License.
 # See: https://github.com/danielgindi/jquery-backstretch
 # -----------------------------------------------------------------------------
*/
(function(d,i,e){var n=/^.*(youtu\.be\/|youtube\.com\/v\/|youtube\.com\/embed\/|youtube\.com\/watch\?v=|youtube\.com\/watch\?.*\&v=)([^#\&\?]*).*/i;var l;d.fn.backstretch=function(v,x){var w=arguments;if(d(i).scrollTop()===0){i.scrollTo(0,0)}var u;this.each(function(A){var C=d(this),B=C.data("backstretch");if(B){if(typeof w[0]==="string"&&typeof B[w[0]]==="function"){var z=B[w[0]].apply(B,Array.prototype.slice.call(w,1));if(z===B){z=e}if(z!==e){u=u||[];u[A]=z}return}x=d.extend(B.options,x);if(B.hasOwnProperty("destroy")){B.destroy(true)}}if(!v||(v&&v.length===0)){var y=C.css("background-image");if(y&&y!=="none"){v=[{url:C.css("backgroundImage").replace(/url\(|\)|"|'/g,"")}]}else{d.error("No images were supplied for Backstretch, or element must have a CSS-defined background image.")}}B=new b(this,v,x||{});C.data("backstretch",B)});return u?u.length===1?u[0]:u:this};d.backstretch=function(u,v){return d("body").backstretch(u,v).data("backstretch")};d.expr[":"].backstretch=function(u){return d(u).data("backstretch")!==e};d.fn.backstretch.defaults={debug:false,duration:5000,transition:"fade",transitionDuration:0,animateFirst:true,alignX:0.5,alignY:0.5,paused:false,start:0,preload:2,preloadSize:1,resolutionRefreshRate:2500,resolutionChangeRatioThreshold:0.1};var j={wrap:{left:0,top:0,overflow:"hidden",margin:0,padding:0,height:"100%",width:"100%",zIndex:-999999},itemWrapper:{position:"absolute",display:"none",margin:0,padding:0,border:"none",width:"100%",height:"100%",zIndex:-999999},item:{position:"absolute",margin:0,padding:0,border:"none",width:"100%",height:"100%",maxWidth:"none"}};var f=(function(){var v=function(x){for(var A=1;A<x.length;A++){var z=x[A],y=A;while(x[y-1]&&parseInt(x[y-1].width,10)>parseInt(z.width,10)){x[y]=x[y-1];--y}x[y]=z}return x};var w=function(D,H,C){var F=i.devicePixelRatio||1;var B=k();var E=p();var y=(H>D)?"portrait":(D>H?"landscape":"square");var x=0;var G;for(var A=0,z;A<C.length;A++){z=C[A];if(typeof z==="string"){z=C[A]={url:z}}if(z.pixelRatio&&z.pixelRatio!=="auto"&&parseFloat(z.pixelRatio)!==F){continue}if(z.deviceOrientation&&z.deviceOrientation!==B){continue}if(z.windowOrientation&&z.windowOrientation!==B){continue}if(z.orientation&&z.orientation!==y){continue}x=A;G=D;if(z.pixelRatio==="auto"){D*=F}if(z.width>=G){break}}return C[Math.min(A,x)]};var u=function(x,z){if(typeof x==="string"){x=x.replace(/{{(width|height)}}/g,z)}else{if(x instanceof Array){for(var y=0;y<x.length;y++){if(x[y].src){x[y].src=u(x[y].src,z)}else{x[y]=u(x[y],z)}}}}return x};return function(E,A){var B=E.width(),F=E.height();var x=[];var C=function(G,H){if(H==="width"){return B}if(H==="height"){return F}return G};for(var y=0;y<A.length;y++){if(d.isArray(A[y])){A[y]=v(A[y]);var z=w(B,F,A[y]);x.push(z)}else{if(typeof A[y]==="string"){A[y]={url:A[y]}}var D=d.extend({},A[y]);D.url=u(D.url,C);x.push(D)}}return x}})();var t=function(u){return n.test(u.url)||u.isVideo};var m=(function(u,x,y,z,C){var v=[];var B=function(E){for(var D=0;D<v.length;D++){if(v[D].src===E.src){return v[D]}}v.push(E);return E};var w=function(D,F,E){if(typeof F==="function"){F.call(D,E)}};return function A(D,I,J,K,L){if(typeof D==="undefined"){return}if(!d.isArray(D)){D=[D]}if(arguments.length<5&&typeof arguments[arguments.length-1]==="function"){L=arguments[arguments.length-1]}I=(typeof I==="function"||!I)?0:I;J=(typeof J==="function"||!J||J<0)?D.length:Math.min(J,D.length);K=(typeof K==="function"||!K)?1:K;if(I>=D.length){I=0;J=0}if(K<0){K=J}K=Math.min(K,J);var H=D.slice(I+K,J-K);D=D.slice(I,K);J=D.length;if(!J){w(D,L,true);return}var M=0;var G=function(){M++;if(M!==J){return}w(D,L,!H);A(H,0,0,K,L)};var E;for(var F=0;F<D.length;F++){if(t(D[F])){continue}else{E=new Image();E.src=D[F].url;E=B(E);if(E.complete){G()}else{d(E).on("load error",G)}}}}})();var g=function(u){var w=[];for(var v=0;v<u.length;v++){if(typeof u[v]==="string"){w.push({url:u[v]})}else{if(d.isArray(u[v])){w.push(g(u[v]))}else{w.push(r(u[v]))}}}return w};var r=function(u,v){if(u.centeredX||u.centeredY){if(i.console&&i.console.log){i.console.log("jquery.backstretch: `centeredX`/`centeredY` is deprecated, please use `alignX`/`alignY`")}if(u.centeredX){u.alignX=0.5}if(u.centeredY){u.alignY=0.5}}if(u.speed!==e){if(i.console&&i.console.log){i.console.log("jquery.backstretch: `speed` is deprecated, please use `transitionDuration`")}u.transitionDuration=u.speed;u.transition="fade"}if(u.resolutionChangeRatioTreshold!==e){i.console.log("jquery.backstretch: `treshold` is a typo!");u.resolutionChangeRatioThreshold=u.resolutionChangeRatioTreshold}if(u.fadeFirst!==e){u.animateFirst=u.fadeFirst}if(u.fade!==e){u.transitionDuration=u.fade;u.transition="fade"}if(u.scale){u.scale=a(u.scale)}return s(u)};var s=function(u,v){if(u.alignX==="left"){u.alignX=0}else{if(u.alignX==="center"){u.alignX=0.5}else{if(u.alignX==="right"){u.alignX=1}else{if(u.alignX!==e||v){u.alignX=parseFloat(u.alignX);if(isNaN(u.alignX)){u.alignX=0.5}}}}}if(u.alignY==="top"){u.alignY=0}else{if(u.alignY==="center"){u.alignY=0.5}else{if(u.alignY==="bottom"){u.alignY=1}else{if(u.alignX!==e||v){u.alignY=parseFloat(u.alignY);if(isNaN(u.alignY)){u.alignY=0.5}}}}}return u};var o={cover:"cover",fit:"fit","fit-smaller":"fit-smaller",fill:"fill"};function a(u){if(!o.hasOwnProperty(u)){return"cover"}return u}var b=function(w,v,y){this.options=d.extend({},d.fn.backstretch.defaults,y||{});this.firstShow=true;r(this.options,true);this.images=g(d.isArray(v)?v:[v]);if(this.options.paused){this.paused=true}if(this.options.start>=this.images.length){this.options.start=this.images.length-1}if(this.options.start<0){this.options.start=0}this.isBody=w===document.body;var z=d(i);this.$container=d(w);this.$root=this.isBody?q?z:d(document):this.$container;this.originalImages=this.images;this.images=f(this.options.alwaysTestWindowResolution?z:this.$root,this.originalImages);m(this.images,this.options.start||0,this.options.preload||1);var x=this.$container.children(".backstretch").first();this.$wrap=x.length?x:d('<div class="backstretch"></div>').css(this.options.bypassCss?{}:j.wrap).appendTo(this.$container);if(!this.options.bypassCss){if(!this.isBody){var u=this.$container.css("position"),A=this.$container.css("zIndex");this.$container.css({position:u==="static"?"relative":u,zIndex:A==="auto"?0:A});this.$wrap.css({zIndex:-999998})}this.$wrap.css({position:this.isBody&&q?"fixed":"absolute"})}this.index=this.options.start;this.show(this.index);z.on("resize.backstretch",d.proxy(this.resize,this)).on("orientationchange.backstretch",d.proxy(function(){if(this.isBody&&i.pageYOffset===0){i.scrollTo(0,1);this.resize()}},this))};var c=function(D){var y=D.transition||"fade";if(typeof y==="string"&&y.indexOf("|")>-1){y=y.split("|")}if(y instanceof Array){y=y[Math.round(Math.random()*(y.length-1))]}var u=D["new"];var B=D.old?D.old:d([]);switch(y.toString().toLowerCase()){default:case"fade":u.fadeIn({duration:D.duration,complete:D.complete,easing:D.easing||e});break;case"fadeinout":case"fade_in_out":var w=function(){u.fadeIn({duration:D.duration/2,complete:D.complete,easing:D.easing||e})};if(B.length){B.fadeOut({duration:D.duration/2,complete:w,easing:D.easing||e})}else{w()}break;case"pushleft":case"push_left":case"pushright":case"push_right":case"pushup":case"push_up":case"pushdown":case"push_down":case"coverleft":case"cover_left":case"coverright":case"cover_right":case"coverup":case"cover_up":case"coverdown":case"cover_down":var x=y.match(/^(cover|push)_?(.*)$/);var v=x[2]==="left"?"right":x[2]==="right"?"left":x[2]==="down"?"top":x[2]==="up"?"bottom":"right";var C={display:""},A={};C[v]="-100%";A[v]=0;u.css(C).animate(A,{duration:D.duration,complete:function(){u.css(v,"");D.complete.apply(this,arguments)},easing:D.easing||e});if(x[1]==="push"&&B.length){var z={};z[v]="100%";B.animate(z,{duration:D.duration,complete:function(){B.css("display","none")},easing:D.easing||e})}break}};b.prototype={resize:function(){try{var O=log4javascript.getLogger("j1.core.attic");var P=this.options.alwaysTestWindowResolution?d(i):this.$root;var v=P.width();var z=P.height();var K=v/(this._lastResizeContainerWidth||0);var M=z/(this._lastResizeContainerHeight||0);var F=this.options.resolutionChangeRatioThreshold||0;if((v!==this._lastResizeContainerWidth||z!==this._lastResizeContainerHeight)&&((Math.abs(K-1)>=F||isNaN(K))||(Math.abs(M-1)>=F||isNaN(M)))){this._lastResizeContainerWidth=v;this._lastResizeContainerHeight=z;this.images=f(P,this.originalImages);if(this.options.preload){m(this.images,(this.index+1)%this.images.length,this.options.preload)}if(this.images.length===1&&this._currentImage.url!==this.images[0].url){var D=this;clearTimeout(D._selectAnotherResolutionTimeout);D._selectAnotherResolutionTimeout=setTimeout(function(){D.show(0)},this.options.resolutionRefreshRate)}}var C={left:0,top:0,right:"auto",bottom:"auto"},E=this.isBody?this.$root.width():this.$root.innerWidth(),A=this.isBody?(i.innerHeight?i.innerHeight:this.$root.height()):this.$root.innerHeight(),x=this.$itemWrapper.data("width"),w=this.$itemWrapper.data("height"),B=(x/w)||1,L=this._currentImage.alignX===e?this.options.alignX:this._currentImage.alignX,I=this._currentImage.alignY===e?this.options.alignY:this._currentImage.alignY,N=a(this._currentImage.scale||this.options.scale);if(this.options.debug){l="resize: boxHeight x boxWidth: "+A+" x "+E;O.debug(l)}if(A==0||E==0){l="Kacke am Schuh";O.warn(l)}var J,H;if(N==="fit"||N==="fit-smaller"){J=x;H=w;if(J>E||H>A||N==="fit-smaller"){var u=E/A;if(u>B){J=Math.floor(A*B);H=A}else{if(u<B){J=E;H=Math.floor(E/B)}else{J=E;H=A}}}}else{if(N==="fill"){J=E;H=A}else{J=Math.max(A*B,E);H=Math.max(J/B,A)}}C.top=-(H-A)*I;C.left=-(J-E)*L;C.width=J;C.height=H;if(!this.options.bypassCss){this.$wrap.css({width:E,height:A}).find(">.backstretch-item").not(".deleteable").each(function(){var Q=d(this);Q.find("img,video,iframe").css(C)})}var G=d.Event("backstretch.resize",{relatedTarget:this.$container[0]});this.$container.trigger(G,this)}catch(y){l="resize: jadams, IE7 hack to let it fail gracefully: "+y;O.warn(l)}return this},show:function(B,y){var C=log4javascript.getLogger("j1.core.attic");if(Math.abs(B)>this.images.length-1){return}var z=this,A=z.$wrap.find(">.backstretch-item").addClass("deleteable"),w=z.videoWrapper,x={relatedTarget:z.$container[0]};z.$container.trigger(d.Event("backstretch.before",x),[z,B]);this.index=B;var v=z.images[B];clearTimeout(z._cycleTimeout);delete z.videoWrapper;var u=t(v);if(u){z.videoWrapper=new h(v);z.$item=z.videoWrapper.$video.css("pointer-events","none")}else{z.$item=d("<img />")}z.$itemWrapper=d('<div class="backstretch-item">').append(z.$item);if(this.options.bypassCss){z.$itemWrapper.css({display:"none"})}else{z.$itemWrapper.css(j.itemWrapper);z.$item.css(j.item)}z.$item.bind(u?"canplay":"load",function(M){var P=d(this),L=P.parent(),S=L.data("options");if(y){S=d.extend({},S,y)}var Q=this.naturalWidth||this.videoWidth||this.width,R=this.naturalHeight||this.videoHeight||this.height;L.data("width",Q).data("height",R);var E=function(T){return S[T]!==e?S[T]:z.options[T]};var N=E("transition");var F=E("transitionEasing");var G=E("transitionDuration");var I=function(){if(w){w.stop();w.destroy()}A.remove();if(!z.paused&&z.images.length>1){z.cycle()}if(!z.options.bypassCss&&!z.isBody){}d(["after","show"]).each(function(){z.$container.trigger(d.Event("backstretch."+this,x),[z,B])});if(u){z.videoWrapper.play()}};if((z.firstShow&&!z.options.animateFirst)||!G||!N){L.show();I()}else{c({"new":L,old:A,transition:N,duration:G,easing:F,complete:I})}z.firstShow=false;var O=this.naturalWidth||this.videoWidth||this.width;var K=this.naturalHeight||this.videoHeight||this.height;var D="show: imageHeight x imageWidth: "+K+" x "+O;if(z.options.debug){C.debug(D)}var J="#"+z.$container["0"]["id"];var H=setInterval(function(){if(d(J).is(":visible")){clearInterval(H);C.info("container visible on id: "+J);z.resize()}},50)});z.$itemWrapper.appendTo(z.$wrap);z.$item.attr("alt",v.alt||"");z.$itemWrapper.data("options",v);if(!u){z.$item.attr("src",v.url)}z._currentImage=v;return z},current:function(){return this.index},next:function(){var u=Array.prototype.slice.call(arguments,0);u.unshift(this.index<this.images.length-1?this.index+1:0);return this.show.apply(this,u)},prev:function(){var u=Array.prototype.slice.call(arguments,0);u.unshift(this.index===0?this.images.length-1:this.index-1);return this.show.apply(this,u)},pause:function(){this.paused=true;if(this.videoWrapper){this.videoWrapper.pause()}return this},resume:function(){this.paused=false;if(this.videoWrapper){this.videoWrapper.play()}this.cycle();return this},cycle:function(){if(this.images.length>1){clearTimeout(this._cycleTimeout);var v=(this._currentImage&&this._currentImage.duration)||this.options.duration;var u=t(this._currentImage);var x=function(){this.$item.off(".cycle");if(!this.paused){this.next()}};if(u){if(!this._currentImage.loop){var w=0;this.$item.on("playing.cycle",function(){var y=d(this).data("player");clearTimeout(w);if(typeof y!="undefined"){w=setTimeout(function(){y.pause();y.$video.trigger("ended")},(y.getDuration()-y.getCurrentTime())*1000)}}).on("ended.cycle",function(){clearTimeout(w)})}this.$item.on("error.cycle initerror.cycle",d.proxy(x,this))}if(u&&!this._currentImage.duration){this.$item.on("ended.cycle",d.proxy(x,this))}else{this._cycleTimeout=setTimeout(d.proxy(x,this),v)}}return this},destroy:function(u){d(i).off("resize.backstretch orientationchange.backstretch");if(this.videoWrapper){this.videoWrapper.destroy()}clearTimeout(this._cycleTimeout);if(!u){this.$wrap.remove()}this.$container.removeData("backstretch")}};var h=function(){this.init.apply(this,arguments)};h.prototype.init=function(C){var y=this;var w;var z=function(){y.$video=w;y.video=w[0]};var A="video";if(!(C.url instanceof Array)&&n.test(C.url)){A="youtube"}y.type=A;if(A==="youtube"){h.loadYoutubeAPI();y.ytId=C.url.match(n)[2];var u="https://www.youtube.com/embed/"+y.ytId+"?rel=0&autoplay=0&showinfo=0&controls=0&modestbranding=1&cc_load_policy=0&disablekb=1&iv_load_policy=3&loop=0&enablejsapi=1&origin="+encodeURIComponent(i.location.origin);y.__ytStartMuted=!!C.mute||C.mute===e;w=d("<iframe />").attr({src_to_load:u}).css({border:0,margin:0,padding:0}).data("player",y);if(C.loop){w.on("ended.loop",function(){if(!y.__manuallyStopped){y.play()}})}y.ytReady=false;z();if(i.YT){y._initYoutube();w.trigger("initsuccess")}else{d(i).one("youtube_api_load",function(){y._initYoutube();w.trigger("initsuccess")})}}else{w=d("<video>").prop("autoplay",false).prop("controls",false).prop("loop",!!C.loop).prop("muted",!!C.mute||C.mute===e).prop("preload","auto").prop("poster",C.poster||"");var v=(C.url instanceof Array)?C.url:[C.url];for(var x=0;x<v.length;x++){var B=v[x];if(typeof(B)==="string"){B={src:B}}d("<source>").attr("src",B.src).attr("type",B.type||null).appendTo(w)}if(!w[0].canPlayType||!v.length){w.trigger("initerror")}else{w.trigger("initsuccess")}z()}};h.prototype._initYoutube=function(){var x=this;var w=i.YT;x.$video.attr("src",x.$video.attr("src_to_load")).removeAttr("src_to_load");var u=!!x.$video[0].parentNode;if(!u){var y=d("<div>").css("display","none !important").appendTo(document.body);x.$video.appendTo(y)}var v=new w.Player(x.video,{events:{onReady:function(){if(x.__ytStartMuted){v.mute()}if(!u){if(x.$video[0].parentNode===y[0]){x.$video.detach()}y.remove()}x.ytReady=true;x._updateYoutubeSize();x.$video.trigger("canplay")},onStateChange:function(z){switch(z.data){case w.PlayerState.PLAYING:x.$video.trigger("playing");break;case w.PlayerState.ENDED:x.$video.trigger("ended");break;case w.PlayerState.PAUSED:x.$video.trigger("pause");break;case w.PlayerState.BUFFERING:x.$video.trigger("waiting");break;case w.PlayerState.CUED:x.$video.trigger("canplay");break}},onPlaybackQualityChange:function(){x._updateYoutubeSize();x.$video.trigger("resize")},onError:function(z){x.hasError=true;x.$video.trigger({type:"error",error:z})}}});x.ytPlayer=v;return x};h.prototype._updateYoutubeSize=function(){var u=this;switch(u.ytPlayer.getPlaybackQuality()||"medium"){case"small":u.video.videoWidth=426;u.video.videoHeight=240;break;case"medium":u.video.videoWidth=640;u.video.videoHeight=360;break;default:case"large":u.video.videoWidth=854;u.video.videoHeight=480;break;case"hd720":u.video.videoWidth=1280;u.video.videoHeight=720;break;case"hd1080":u.video.videoWidth=1920;u.video.videoHeight=1080;break;case"highres":u.video.videoWidth=2560;u.video.videoHeight=1440;break}return u};h.prototype.play=function(){var u=this;u.__manuallyStopped=false;if(u.type==="youtube"){if(u.ytReady){u.$video.trigger("play");u.ytPlayer.playVideo()}}else{u.video.play()}return u};h.prototype.pause=function(){var u=this;u.__manuallyStopped=false;if(u.type==="youtube"){if(u.ytReady){u.ytPlayer.pauseVideo()}}else{u.video.pause()}return u};h.prototype.stop=function(){var u=this;u.__manuallyStopped=true;if(u.type==="youtube"){if(u.ytReady){u.ytPlayer.pauseVideo();u.ytPlayer.seekTo(0)}}else{u.video.pause();u.video.currentTime=0}return u};h.prototype.destroy=function(){var u=this;if(u.ytPlayer){u.ytPlayer.destroy()}u.$video.remove();return u};h.prototype.getCurrentTime=function(v){var u=this;if(u.type==="youtube"){if(u.ytReady){return u.ytPlayer.getCurrentTime()}}else{return u.video.currentTime}return 0};h.prototype.setCurrentTime=function(v){var u=this;if(u.type==="youtube"){if(u.ytReady){u.ytPlayer.seekTo(v,true)}}else{u.video.currentTime=v}return u};h.prototype.getDuration=function(){var u=this;if(u.type==="youtube"){if(u.ytReady){return u.ytPlayer.getDuration()}}else{return u.video.duration}return 0};h.loadYoutubeAPI=function(){if(i.YT){return}if(!d("script[src*=www\\.youtube\\.com\\/iframe_api]").length){d('<script type="text/javascript" src="https://www.youtube.com/iframe_api">').appendTo("body")}var u=setInterval(function(){if(i.YT&&i.YT.loaded){d(i).trigger("youtube_api_load");clearTimeout(u)}},50)};var k=function(){if("matchMedia" in i){if(i.matchMedia("(orientation: portrait)").matches){return"portrait"}else{if(i.matchMedia("(orientation: landscape)").matches){return"landscape"}}}if(screen.height>screen.width){return"portrait"}return"landscape"};var p=function(){if(i.innerHeight>i.innerWidth){return"portrait"}if(i.innerWidth>i.innerHeight){return"landscape"}return"square"};var q=(function(){var v=navigator.userAgent,x=navigator.platform,D=v.match(/AppleWebKit\/([0-9]+)/),B=!!D&&D[1],w=v.match(/Fennec\/([0-9]+)/),z=!!w&&w[1],A=v.match(/Opera Mobi\/([0-9]+)/),u=!!A&&A[1],y=v.match(/MSIE ([0-9]+)/),C=!!y&&y[1];return !(((x.indexOf("iPhone")>-1||x.indexOf("iPad")>-1||x.indexOf("iPod")>-1)&&B&&B<534)||(i.operamini&&({}).toString.call(i.operamini)==="[object OperaMini]")||(A&&u<7458)||(v.indexOf("Android")>-1&&B&&B<533)||(z&&z<6)||("palmGetResource" in i&&B&&B<534)||(v.indexOf("MeeGo")>-1&&v.indexOf("NokiaBrowser/8.5.0")>-1)||(C&&C<=6))}())}(jQuery,window));
