/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/lunr/js/jquery.lunr.search.js
 # jQuery plugin to use with J1LunrSearch
 #
 # Product/Info:
 # https://jekyll.one
 #
 # Copyright (C) 2021 Juergen Adams
 #
 # J1 Template is licensed under the MIT License.
 # See: https://github.com/jekyll-one-org/J1 Template/blob/master/LICENSE
 # -----------------------------------------------------------------------------
 # TODO:
 # -----------------------------------------------------------------------------
*/
"use strict";!function(t){var e=function(t){var e=t.match(/(\d+)/g);return new Date(e[0],e[1]-1,e[2])},n=function(){function n(e,n){this.$elem=e,this.$results=t(n.results),this.indexDataUrl=n.indexUrl,this.template=this.compileTemplate(t(n.template)),this.titleMsg=n.titleMsg,this.emptyMsg=n.emptyMsg,this.onAfterResultShow=n.onAfterResultShow,this.initialize()}return n.prototype.initialize=function(){var e=this;this.loadIndexData(function(n){e.docs=t.map(n.docs,e.createEntry),e.index=lunr.Index.load(n.index),e.populateSearchFromQuery(),e.bindKeypress()})},n.prototype.compileTemplate=function(t){var e=t.text();return Mustache.parse(e),function(t,n){return Mustache.render(e,t,n)}},n.prototype.loadIndexData=function(e){t.getJSON(this.indexDataUrl,e)},n.prototype.createEntry=function(n,r){var s=t.extend({id:r+1},n);return n.date&&t.extend(s,{date:e(n.date),pubdate:function(){return dateFormat(e(n.date),"yyyy-mm-dd")},displaydate:function(){return dateFormat(e(n.date),"mmm dd, yyyy")}}),s},n.prototype.bindKeypress=function(){var t,e,n,r=this,s=this.$elem.val();this.$elem.bind("keyup",(t=function(){var t=r.$elem.val();t!==s&&r.search(t),s=t},n=Array.prototype.slice,function(){var r=n.call(arguments),s=this;clearTimeout(e),e=setTimeout(function(){t.apply(s,r)},100)}))},n.prototype.search=function(e){var n=this.docs;if(e.length<3)this.$results.hide().empty();else{var r=t.map(this.index.search(e),function(e){return t.grep(n,function(t){return t.id===parseInt(e.ref,10)})[0]});this.displayResults(r),this.onAfterResultShow()}},n.prototype.displayResults=function(t){var e=this.$results;e.empty(),0===t.length?e.append(this.emptyMsg):(this.titleMsg&&0!==this.titleMsg.length&&e.append(this.titleMsg),e.append(this.template({docs:t}))),e.show()},n.prototype.populateSearchFromQuery=function(){var t=new URI(window.location.search.toString()).search(!0);t.hasOwnProperty("q")&&(this.$elem.val(t.q),this.search(t.q.toString()))},n}();t.fn.lunrSearch=function(e){return e=t.extend({},t.fn.lunrSearch.defaults,e),new n(this,e),this},t.fn.lunrSearch.defaults={indexUrl:"/assets/data/lunr-index.json",results:"#search-results",template:"#search-results-template",titleMsg:"<h1>Search results<h1>",emptyMsg:"<p>Nothing found.</p>",onAfterResultShow:function(){}}}(jQuery);
